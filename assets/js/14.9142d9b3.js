(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{413:function(s,e,n){"use strict";n.r(e);var a=n(2),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("node  session  cookies")])]),s._v(" "),n("h2",{attrs:{id:"express-ä¸­ä½¿ç”¨session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#express-ä¸­ä½¿ç”¨session"}},[s._v("#")]),s._v(" express ä¸­ä½¿ç”¨session")]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"å¯¼å…¥session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¯¼å…¥session"}},[s._v("#")]),s._v(" å¯¼å…¥session")]),s._v(" "),n("blockquote",[n("p",[s._v("npm i express-session")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// å¯¼å…¥ express æ¨¡å—\nconst express = require('express')\n// åˆ›å»º express çš„æœåŠ¡å™¨å®ä¾‹\nconst app = express()\n\n// TODO_01ï¼šè¯·é…ç½® Session ä¸­é—´ä»¶\nconst session = require('express-session')\napp.use(\n  session({\n    secret: 'itheima', //ä»»æ„å­—ç¬¦ä¸²\n    resave: false,\n    saveUninitialized: true,\n  })\n)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("blockquote",[n("p",[s._v("å½“express-sessioné…ç½®å®Œæˆå  å¯ä»¥é€šè¿‡req.session æ¥è®¿é—®å’Œä½¿ç”¨session")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"åˆ¤æ–­session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åˆ¤æ–­session"}},[s._v("#")]),s._v(" åˆ¤æ–­session")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("app.get('/api/username', (req, res) => {\n        if (req.session.islogin) {\n            return res.send({ static: 1, msg: \"fail\" })\n        }\n        res.send({\n            static: 0,\n            msg: 'success',\n            username: req.session.username\n        })\n    })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"é€€å‡ºsession"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é€€å‡ºsession"}},[s._v("#")]),s._v(" é€€å‡ºsession")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("app.use('/api/out', (res, req) => {\n    req.session.destroy() //æ¸…ç©ºè¯¥session\n    res.send({\n        static: 0,\n        msg: 'é€€å‡ºç™»å½•'\n    })\n})\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"jwt-è®¤è¯æœºåˆ¶"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jwt-è®¤è¯æœºåˆ¶"}},[s._v("#")]),s._v(" JWT è®¤è¯æœºåˆ¶")]),s._v(" "),n("blockquote",[n("p",[s._v("ä¸‰éƒ¨åˆ†ç»„æˆ   Header(å¤´éƒ¨)  Payload(æœ‰æ•ˆè·è½½)  Signature (ç­¾å)"),n("br"),s._v("\nAuthorization : Bearer < token >\nå®‰è£…çš„åŒ…ï¼š"),n("br"),s._v("\nnpm i jsonwebtoken express-jwt "),n("br"),s._v("  jsonwebtoken ç”ŸæˆJWTå­—ç¬¦ä¸²  express-jwt å°†JWTè¿˜åŸæˆjsonå¯¹è±¡")])]),s._v(" "),n("h3",{attrs:{id:"å¯¼å…¥jwtç›¸å…³çš„åŒ…"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¯¼å…¥jwtç›¸å…³çš„åŒ…"}},[s._v("#")]),s._v(" å¯¼å…¥JWTç›¸å…³çš„åŒ…")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// TODO_01ï¼šå®‰è£…å¹¶å¯¼å…¥ JWT ç›¸å…³çš„ä¸¤ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯ jsonwebtoken å’Œ express-jwt\nconst jwt = require('jsonwebtoken')\nconst expressJWT = require('express-jwt')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("h3",{attrs:{id:"ä½¿ç”¨jwt-åŠ å¯†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨jwt-åŠ å¯†"}},[s._v("#")]),s._v(" ä½¿ç”¨JWT åŠ å¯†")]),s._v(" "),n("blockquote",[n("p",[s._v("è°ƒç”¨jsonwebtoken åŒ…æä¾›çš„sign()æ–¹æ³•ï¼Œå°†ç”¨æˆ·çš„ä¿¡æ¯åŠ å¯†æˆjwtå­—ç¬¦ä¸²")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" // ç™»å½•æˆåŠŸ\n  // TODO_03ï¼šåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œè°ƒç”¨ jwt.sign() æ–¹æ³•ç”Ÿæˆ JWT å­—ç¬¦ä¸²ã€‚å¹¶é€šè¿‡ token å±æ€§å‘é€ç»™å®¢æˆ·ç«¯\n  // å‚æ•°1ï¼šç”¨æˆ·çš„ä¿¡æ¯å¯¹è±¡\n  // å‚æ•°2ï¼šåŠ å¯†çš„ç§˜é’¥\n  // å‚æ•°3ï¼šé…ç½®å¯¹è±¡ï¼Œå¯ä»¥é…ç½®å½“å‰ token çš„æœ‰æ•ˆæœŸ\n  // è®°ä½ï¼šåƒä¸‡ä¸è¦æŠŠå¯†ç åŠ å¯†åˆ° token å­—ç¬¦ä¸­\n  const tokenStr = jwt.sign({ username: userinfo.username }, secretKey, { expiresIn: '30s' })\n  res.send({\n    status: 200,\n    message: 'ç™»å½•æˆåŠŸï¼',\n    token: tokenStr, // è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ token å­—ç¬¦ä¸²\n  })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"é…ç½®å“ªäº›æ¥å£ä¸éœ€è¦é…ç½®token-unlessæ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®å“ªäº›æ¥å£ä¸éœ€è¦é…ç½®token-unlessæ–¹æ³•"}},[s._v("#")]),s._v(" é…ç½®å“ªäº›æ¥å£ä¸éœ€è¦é…ç½®token  unlessæ–¹æ³•")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// æ³¨æ„ï¼šåªè¦é…ç½®æˆåŠŸäº† express-jwt è¿™ä¸ªä¸­é—´ä»¶ï¼Œå°±å¯ä»¥æŠŠè§£æå‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒæŒ‚è½½åˆ° req.user å±æ€§ä¸Š\napp.use(expressJWT({ secret: secretKey }).unless({ path: [/^\\/api\\//] }))\n// æŒ‡å®šunless({ path: [/^\\/api\\//] })  apiå¼€å¤´çš„æ¥å£ä¸éœ€è¦è°ƒç”¨tokenåŠ å¯†\n//é…ç½®æˆåŠŸå  ä¼šè‡ªåŠ¨å°†è§£æå‡ºæ¥çš„ä¿¡æ¯ æŒ‚è½½åˆ°req.userä¸Š\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"å°†jwtåŠ å¯†å­—ç¬¦ä¸²è¿˜åŸæˆjsonå¯¹è±¡-express-jwt-ğŸ‘†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å°†jwtåŠ å¯†å­—ç¬¦ä¸²è¿˜åŸæˆjsonå¯¹è±¡-express-jwt-ğŸ‘†"}},[s._v("#")]),s._v(" å°†JWTåŠ å¯†å­—ç¬¦ä¸²è¿˜åŸæˆJSONå¯¹è±¡  express-jwt  ğŸ‘†")]),s._v(" "),n("blockquote",[n("p",[s._v("è¯·æ±‚å¤´ä¸­çš„Authorizationå­—æ®µ  ç”¨express-jwtä¸­é—´ä»¶è¿˜åŸ   "),n("br"),s._v("\nAPIè°ƒç”¨æ—¶å€™  åœ¨è¯·æ±‚å¤´æ·»åŠ  Authorization    valueï¼š   Bearer+token æ‰è¡Œ")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// è¿™æ˜¯ä¸€ä¸ªæœ‰æƒé™çš„ API æ¥å£\napp.get('/admin/getinfo', function(req, res) {\n    // TODO_05ï¼šä½¿ç”¨ req.user è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ data å±æ€§å°†ç”¨æˆ·ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯\n    console.log(req.user)// æˆåŠŸæœ‰æ•ˆçš„ æ‰èƒ½æœ‰req.userå€¼\n    res.send({\n        status: 200,\n        message: 'è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼',\n        data: req.user, // è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ç”¨æˆ·ä¿¡æ¯\n    })\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"åˆ¤æ–­å…¨å±€æ— æ•ˆtoken-é”™è¯¯ä¸­é—´ä»¶"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åˆ¤æ–­å…¨å±€æ— æ•ˆtoken-é”™è¯¯ä¸­é—´ä»¶"}},[s._v("#")]),s._v(" åˆ¤æ–­å…¨å±€æ— æ•ˆtoken é”™è¯¯ä¸­é—´ä»¶")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// TODO_06ï¼šä½¿ç”¨å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼Œæ•è·è§£æ JWT å¤±è´¥åäº§ç”Ÿçš„é”™è¯¯\napp.use((err, req, res, next) => {\n    // è¿™æ¬¡é”™è¯¯æ˜¯ç”± token è§£æå¤±è´¥å¯¼è‡´çš„\n    if (err.name === 'UnauthorizedError') {\n        return res.send({\n            status: 401,\n            message: 'æ— æ•ˆçš„token',\n        })\n    }\n    res.send({\n        status: 500,\n        message: 'æœªçŸ¥çš„é”™è¯¯',\n    })\n})\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†"}},[s._v("#")]),s._v(" å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†")]),s._v(" "),n("p",[s._v("åœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œä½¿ç”¨"),n("code",[s._v("bcryptjs")]),s._v("å¯¹ç”¨æˆ·å¯†ç è¿›è¡ŒåŠ å¯†")]),s._v(" "),n("ol",[n("li",[s._v("åŠ å¯†åçš„å¯†ç ï¼Œæ— æ³•è¢«é€†å‘ç ´è§£")]),s._v(" "),n("li",[s._v("åŒä¸€æ˜æ–‡å¯†ç ï¼Œå¤šæ¬¡åŠ å¯†å¾—åˆ°çš„ç»“æœä¸ä¸€æ ·")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\x3c!-- å®‰è£…ï¼š --\x3e\nnpm i bcryptjs@2.4.3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",[n("li",[s._v("åœ¨æ³¨å†Œç”¨æˆ·çš„å¤„ç†å‡½æ•°ä¸­ï¼Œç¡®è®¤ç”¨æˆ·åå¯ç”¨ä¹‹åï¼Œè°ƒç”¨ bcrypt.hashSync(æ˜æ–‡å¯†ç , éšæœºç›çš„é•¿åº¦) æ–¹æ³•ï¼Œå¯¹ç”¨æˆ·çš„å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†ï¼š")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// å¯¹ç”¨æˆ·çš„å¯†ç ,è¿›è¡Œ bcrype åŠ å¯†ï¼Œè¿”å›å€¼æ˜¯åŠ å¯†ä¹‹åçš„å¯†ç å­—ç¬¦ä¸²\nuserinfo.password = bcrypt.hashSync(userinfo.password, 10)\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);